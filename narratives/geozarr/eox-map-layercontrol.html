<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoZarr Map</title>
    <style>
        body { margin: 0; padding: 0; }
        .container { display: flex; width: 100%; height: 100vh; }
        eox-layercontrol { flex: 1; height: 100%; overflow: auto; }
        eox-map { flex: 2; height: 100%; }
    </style>
</head>
<body>
    <div class="container">
        <eox-map id="story-map"></eox-map>
        <eox-layercontrol for="#story-map" tools='["config"]'></eox-layercontrol>
    </div>
    
    <script type="module">
        import "https://cdn.jsdelivr.net/npm/@eox/map@2.1.0-dev.1/dist/eox-map.js";
        import "https://cdn.jsdelivr.net/npm/@eox/map@2.1.0-dev.1/dist/eox-map-advanced-layers-and-sources.js";
        import "https://cdn.jsdelivr.net/npm/@eox/layercontrol@latest/dist/eox-layercontrol.js";
        
        await customElements.whenDefined("eox-map");
        await customElements.whenDefined("eox-layercontrol");
        
        const mapElement = document.getElementById("story-map");
        
        // Set map properties with GeoZarr configuration
        mapElement.layers = [
            {
                "type": "Tile",
                "properties": {
                    "id": "osm-basemap",
                    "title": "OpenStreetMap"
                },
                "source": { "type": "OSM" }
            },
            {
                "type": "WebGLTile",
                "properties": {
                    "id": "geozarr-layer",
                    "title": "Sentinel-2 GeoZarr",
                    "layerControlExpand": true
                },
                "source": {
                    "type": "GeoZarr",
                    "url": "https://s3.explorer.eopf.copernicus.eu/esa-zarr-sentinel-explorer-fra/tests-output/sentinel-2-l2a/S2A_MSIL2A_20251107T100231_N0511_R122_T32TQR_20251107T115310.zarr",
                    "group": "measurements/reflectance",
                    "bands": ["b04", "b03", "b02"]
                },
                "style": {
                    "gamma": 1.5,
                    "color": [
                        "color",
                        ["interpolate", ["linear"], ["band", 1], 0, 0, 0.5, 255],
                        ["interpolate", ["linear"], ["band", 2], 0, 0, 0.5, 255],
                        ["interpolate", ["linear"], ["band", 3], 0, 0, 0.5, 255],
                        ["case", ["==", ["+", ["band", 1], ["band", 2], ["band", 3]], 0], 0, 1]
                    ]
                }
            }
        ];
        mapElement.center = [12.3155, 45.4408];
        mapElement.zoom = 10;
        
        // Zoom to the item extent after map loads
        mapElement.addEventListener("loadcomplete", () => {
            mapElement.zoomExtent = [11.858994964808403, 44.099770918209835, 12.936097556086393, 45.10721083440407];
        });
    </script>
</body>
</html>
